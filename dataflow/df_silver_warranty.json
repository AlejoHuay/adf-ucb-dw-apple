{
	"name": "df_silver_warranty",
	"properties": {
		"folder": {
			"name": "silver"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_sql_warranty",
						"type": "DatasetReference"
					},
					"name": "dsWarranty"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_sql_silver_warranty",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "normalizeStatus"
				},
				{
					"name": "fixSaleId"
				},
				{
					"name": "cleanClaimDate"
				},
				{
					"name": "claimDateToDate"
				},
				{
					"name": "filtrarNulos"
				},
				{
					"name": "selectColumns"
				}
			],
			"scriptLines": [
				"source(output(",
				"          claim_id as string,",
				"          claim_date as string,",
				"          sale_id as string,",
				"          repair_status as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> dsWarranty",
				"cleanClaimDate derive(repair_status_clean = iif(\r",
				"    lower(trim(repair_status)) == 'completed', 'Completed',\r",
				"    iif(\r",
				"        lower(trim(repair_status)) == 'pending' || lower(trim(repair_status)) == 'pendng', 'Pending',\r",
				"        iif(\r",
				"            lower(trim(repair_status)) == 'in progress', 'In Progress',\r",
				"            iif(\r",
				"                lower(trim(repair_status)) == 'rejected' || lower(trim(repair_status)) == 'rejectd' || lower(trim(repair_status)) == 'rejcted', 'Rejected',\r",
				"                'Unknown'\r",
				"            )\r",
				"        )\r",
				"    )\r",
				")) ~> normalizeStatus",
				"normalizeStatus derive(sale_id_clean = iif(isNull(sale_id) || trim(sale_id) == '', 'UNKNOWN', sale_id)) ~> fixSaleId",
				"dsWarranty derive(claim_date_clean = iif(\r",
				"    !isNull(toDate(claim_date, 'M/d/yyyy', 'MM/dd/yyyy')), \r",
				"    toDate(claim_date, 'M/d/yyyy', 'MM/dd/yyyy'),\r",
				"    iif(\r",
				"        !isNull(toDate(claim_date, 'dd-MM-yyyy', 'd-MM-yyyy')), \r",
				"        toDate(claim_date, 'dd-MM-yyyy', 'd-MM-yyyy'),\r",
				"        iif(\r",
				"            !isNull(toDate(claim_date, 'yyyy/MM/dd')), \r",
				"            toDate(claim_date, 'yyyy/MM/dd'),\r",
				"            toDate(claim_date, 'yyyy-MM-dd') \r",
				"        )\r",
				"    )\r",
				")) ~> cleanClaimDate",
				"fixSaleId cast(output(",
				"          claim_date_clean as date 'yyyy-MM-dd'",
				"     ),",
				"     errors: true) ~> claimDateToDate",
				"claimDateToDate filter(!isNull(claim_date_clean) && !isNull(claim_id) && !isNull(sale_id_clean)) ~> filtrarNulos",
				"filtrarNulos select(mapColumn(",
				"          claim_id,",
				"          claim_date = claim_date_clean,",
				"          sale_id = sale_id_clean,",
				"          repair_status = repair_status_clean",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectColumns",
				"selectColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          claim_id as string,",
				"          claim_date as date,",
				"          sale_id as string,",
				"          repair_status as string",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          claim_id,",
				"          claim_date,",
				"          sale_id,",
				"          repair_status",
				"     )) ~> sink1"
			]
		}
	}
}